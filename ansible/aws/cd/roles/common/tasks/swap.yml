---
- name: Create swap file
  command: fallocate -l {{ swapsize }} {{ swap_file }}{{ swapsize }} creates={{ swap_file }}{{ swapsize }}

- name: Change swap file permissions
  file:
    path: {{ swap_file }}{{ swapsize }}
    owner: root
    group: root
    mode: 0600

- name: Format swap file
  command: mkswap {{ swap_file }}{{ swapsize }}

- name: mount swap volume
  command: swapon {{ swap_file }}{{ swapsize }}

- name: update fstab
  mount:
    name: none
    src: {{ swap_file }}{{ swapsize }}
    fstype: swap
    opts: defaults
    state: present
